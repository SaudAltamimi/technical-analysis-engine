# Custom Strategy Builder & Tester - Streamlit Frontend

A user-friendly web interface for creating and testing custom trading strategies with real market data visualization.

## 🏗️ Separated Architecture

This app follows a **clean separation of concerns**:

- **🎨 Frontend Only**: Pure Streamlit UI with minimal dependencies  
- **🔌 API Communication**: All functionality via HTTP API calls only
- **⚡ No Engine Dependencies**: No vectorbt, no heavy analysis libraries
- **📦 Independent Installation**: Uses pip, separate from main uv environment
- **🔄 Zero Coupling**: Engine changes don't affect frontend, vice versa

## 🚀 Features

### Strategy Builder
- **Interactive Strategy Creation**: Build custom strategies with multiple indicators
- **Real-time Price Visualization**: View OHLC candlestick charts with overlaid indicators
- **Signal Generation**: See buy/sell signals generated by your strategy rules
- **Ticker Validation**: Validate tickers before creating strategies
- **Strategy Recommendations**: Get ticker recommendations based on strategy type

### Strategy Tester
- **Comprehensive Backtesting**: Test strategies against historical data
- **Performance Metrics**: View detailed performance statistics
- **Visual Analysis**: Interactive charts showing:
  - OHLC price data with candlestick charts
  - Technical indicators overlaid on price charts
  - Buy/sell signals marked with green/red triangles
  - Performance comparison vs buy-and-hold
- **Export Capabilities**: Download results as JSON

## 📊 New Visualization Features

### Price Charts with Signals
The app now displays comprehensive price charts that include:

1. **OHLC Candlestick Charts**: Full price action with open, high, low, close data
2. **Technical Indicators**: All configured indicators overlaid on the chart
3. **Trading Signals**: 
   - Green triangles (▲) for buy signals
   - Red triangles (▼) for sell signals
4. **Signal Summary**: Metrics showing total signals, buy/sell counts, and completed trades
5. **Performance Comparison**: Strategy returns vs buy-and-hold benchmarks

### How to Use

1. **Create a Strategy**:
   - Go to Strategy Builder
   - Add indicators (EMA, SMA, RSI, MACD)
   - Set up crossover or threshold rules
   - Select a ticker and time period
   - Click "Create Strategy"

2. **View Analysis**:
   - Immediately see price chart with indicators
   - Review generated buy/sell signals
   - Check signal summary statistics

3. **Backtest Strategy**:
   - Go to Strategy Tester
   - Configure backtesting parameters
   - Run comprehensive backtest
   - Analyze performance charts and metrics

## 🛠️ Setup & Usage

### Prerequisites
- FastAPI backend running on `http://localhost:8000`
- Python environment with requirements installed

### Installation
```bash
# Install Streamlit environment
make setup-streamlit

# Or manually:
pip install -r requirements.txt
```

### Running the App
```bash
# Using Makefile
make streamlit

# Or manually:
streamlit run streamlit_app.py
```

### Development Mode
```bash
# Run both API and Streamlit together
make dev
```

## 🔧 Configuration

### API Connection
The app connects to the FastAPI backend at `http://localhost:8000`. Ensure the API is running before starting the Streamlit app.

### Supported Indicators
- **EMA**: Exponential Moving Average
- **SMA**: Simple Moving Average  
- **RSI**: Relative Strength Index
- **MACD**: Moving Average Convergence Divergence

### Strategy Rules
- **Crossover Rules**: When one indicator crosses above/below another
- **Threshold Rules**: When an indicator crosses above/below a specific value

## 📈 Chart Examples

The visualization now shows:
- Full OHLC price data as candlestick charts
- Multiple indicators on the same chart
- Clear buy/sell signal markers
- Professional-looking financial charts with proper scaling

## 🔗 Dependencies

### Core Dependencies
- `streamlit>=1.28.0` - Web app framework
- `requests>=2.31.0` - API communication
- `plotly>=5.17.0` - Interactive charts
- `pandas>=2.0.0` - Data handling

### Chart Visualization
- Plotly candlestick charts for OHLC data
- Line charts for technical indicators
- Scatter plots for trading signals
- Interactive zoom and pan capabilities

## 🚀 Next Steps

1. Create your first strategy in the Strategy Builder
2. Test it with different tickers and time periods
3. Analyze the generated signals on the price charts
4. Run backtests to evaluate performance
5. Export results for further analysis

## 💡 Tips

- Use longer time periods (1+ years) for more reliable backtesting
- Test strategies on different asset classes
- Compare your strategy performance against buy-and-hold
- Consider transaction costs in real trading scenarios

## 🎯 Usage

### Method 1: Using the run script
```bash
cd src/streamlit_app
python run_streamlit.py
```

### Method 2: Direct Streamlit command
```bash
cd src/streamlit_app
streamlit run streamlit_app.py
```

### Method 3: Custom configuration
```bash
cd src/streamlit_app
streamlit run streamlit_app.py --server.port=8501 --theme.base=light
```

## 📖 User Guide

### 🔧 Strategy Builder Page

1. **Basic Information**
   - Enter strategy name and description
   - Select strategy type for ticker recommendations

2. **Ticker Selection**
   - Search by symbol/name or browse popular tickers
   - Get recommendations based on strategy type
   - Validate ticker before proceeding

3. **Indicators Configuration**
   - Add indicators (EMA, SMA, RSI, MACD)
   - Configure parameters for each indicator
   - Delete unwanted indicators

4. **Trading Rules**
   - **Crossover Rules**: Fast indicator crosses slow indicator
   - **Threshold Rules**: Indicator crosses a threshold value
   - Configure buy/sell signals

5. **Analysis Period**
   - Select time period and interval
   - Create and analyze your strategy

### 🧪 Strategy Tester Page

1. **Strategy Selection**
   - Use strategy from Builder or input JSON manually
   - View strategy details and configuration

2. **Backtesting Configuration**
   - Set initial capital and commission
   - Choose position sizing method
   - Select time period (strategy default or custom range)

3. **Run Backtest**
   - Execute backtest via API
   - View performance metrics
   - Analyze results and export data

## 🔗 API Integration

This app uses **only API endpoints** - no direct engine interaction:

### Strategy Builder APIs:
- `GET /indicators/types` - Available indicators
- `GET /periods` - Time periods and intervals
- `GET /tickers/popular` - Popular ticker lists
- `POST /tickers/search` - Search tickers
- `GET /tickers/{symbol}/validate` - Validate ticker
- `GET /tickers/recommendations/{strategy_type}` - Strategy-specific tickers
- `POST /strategies/custom` - Create custom strategy

### Strategy Tester APIs:
- `GET /tickers/{symbol}/info` - Ticker information
- `POST /backtest/custom/ticker` - Run ticker backtest
- `POST /backtest/custom/date-range` - Run date range backtest

## 🎨 Features & Benefits

### ✨ User-Friendly Interface
- Clean, intuitive design with Streamlit
- Real-time API status monitoring
- Interactive forms with validation
- Expandable sections for better organization

### 🔍 Smart Recommendations
- Strategy-type specific ticker suggestions
- Indicator usage examples
- Recommended time periods
- Best practices tips

### 📊 Comprehensive Testing
- Multiple backtesting methods
- Customizable parameters
- Performance metrics display
- Export capabilities

### 🛡️ Robust Error Handling
- API connection monitoring
- Request timeout handling
- Validation feedback
- Clear error messages

## 🚨 Important Notes

### API Dependency
- **FastAPI server must be running** on `http://localhost:8000`
- App will show connection status in sidebar
- All functionality disabled if API unavailable

### Development Benefits
- **Zero direct engine coupling** - ensures API works properly
- **Real-world API testing** - validates all endpoints
- **Multi-developer friendly** - others can use APIs independently
- **Production ready** - API-first architecture

## 🔧 Customization

### API Base URL
Update `API_BASE_URL` in `streamlit_app.py`:
```python
API_BASE_URL = "http://your-api-server:port"
```

### Styling
Modify Streamlit configuration:
```bash
streamlit run streamlit_app.py --theme.base=dark --theme.primaryColor=#ff6b6b
```

### Page Configuration
Edit page settings in `streamlit_app.py`:
```python
st.set_page_config(
    page_title="Your Custom Title",
    page_icon="📈",
    layout="wide"
)
```

## 🐛 Troubleshooting

### Common Issues

1. **API Connection Failed**
   - Ensure FastAPI server is running: `uvicorn main:app --reload`
   - Check URL: `http://localhost:8000/health`

2. **Import Errors**
   - Run setup: `make setup` from project root
   - Check uv environment: `uv venv` and dependencies

3. **Streamlit Issues**
   - Clear cache: `streamlit cache clear`
   - Restart app: `Ctrl+C` then `streamlit run streamlit_app.py`

### Debug Mode
Add debugging to `streamlit_app.py`:
```python
import streamlit as st
st.set_option('deprecation.showPyplotGlobalUse', False)
```

## 📞 Support

- Check API documentation at `http://localhost:8000/docs`
- Monitor API logs for detailed error information
- Use browser developer tools for network debugging

---

**🎯 Perfect for:** Strategy development, API testing, user demos, and educational purposes! 